import{_ as i,n as s,p as o,q as h,s as e,R as r,t as n,Y as t}from"./framework-f2b64c38.js";const c={},p=t('<h1 id="二师浴室水控学习版" tabindex="-1"><a class="header-anchor" href="#二师浴室水控学习版" aria-hidden="true">#</a> 二师浴室水控学习版</h1><h2 id="起因" tabindex="-1"><a class="header-anchor" href="#起因" aria-hidden="true">#</a> 起因</h2><p>学校宿舍洗澡改成了蓝牙水控，每天有补助，但补助用完想用就没办法用了，充值也行不通<br> 听说有个同学做了一个无线热水的小程序<br> 本着学习的心态，我也打算研究一下</p><h2 id="思路" tabindex="-1"><a class="header-anchor" href="#思路" aria-hidden="true">#</a> 思路</h2><p>基本思路首先是小程序抓包看一下数据</p><h3 id="小程序抓包" tabindex="-1"><a class="header-anchor" href="#小程序抓包" aria-hidden="true">#</a> 小程序抓包</h3><p>这个步骤我尝试了很多办法<br> 给出我成功的方案：</p><ul><li>安卓</li><li>Android6.0</li><li>微信7.0+</li><li>BurpSuite</li></ul><p>其他的曾经尝试过</p><ul><li>r0capture,失败，root后运行frida-server死机重启</li><li>Xposed，失败，无法解锁system分区，没有写入权限</li><li>PC运行手机模拟器，下载的时候直接提示网络有问题，放弃</li></ul>',10),l=e("br",null,null,-1),d={href:"https://www.cnblogs.com/tdcqma/p/6000107.html",target:"_blank",rel:"noopener noreferrer"},u=t('<p>设置代理的IP和端口</p><img src="https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora20210311225937.png"><h3 id="蓝牙抓包" tabindex="-1"><a class="header-anchor" href="#蓝牙抓包" aria-hidden="true">#</a> 蓝牙抓包</h3><p>这个问题是在我小程序抓完包后<br> 发现没有蓝牙相关的数据<br> 搜索一番后发现蓝牙抓包需要别的方式<br> 给出我成功的方案：</p><ul><li>安卓</li><li>开发者选项打开蓝牙调试日志</li></ul><p>一开始搜的时候都是说nrf sniff，但这个需要硬件支持<br> 我没有，几经周折才发现可以在手机上直接拿到蓝牙日志<br> 我的日志文件名是btsnoop_hci.log<br> 拿到日志后放到wireshark中即可查看</p><h2 id="实践" tabindex="-1"><a class="header-anchor" href="#实践" aria-hidden="true">#</a> 实践</h2><p>在抓包环境搭建好后<br> 打开官方小程序<br> 先走一遍完整流程，包括扫描，启动，停止 查看BurpSuite抓到了什么包</p><img src="https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora20210311231311.png"><p>可以看到这里有几个api，结合启动/停止操作，得出一下结论</p><ul><li>启动过程中，会调用getOpenSendData和saveAlarmData接口</li><li>停止过程中，会执行saveConsLog和getTemperatureSetData接口</li></ul><p>结合接口参数以及返回参数来看，首先可以知道<br> saveConsLog是保存消费记录<br> 那么是否可以在停止时不提交消费记录，来达到无限使用是我目前的思路</p><img src="https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora20210311232558.png"><p>但是在BurpSuite抓包完后，我意识到这里没有与蓝牙交互<br> 于是才知道蓝牙是蓝牙协议通信BLE<br> 于是有了上面的蓝牙抓包</p><p>通过wireshark查看蓝牙日志<br> 使用btatt过滤</p><img src="https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora20210311232900.png"><p>这里经过反复测试和比较<br> 得出启动与停止过程的蓝牙数据</p><img src="https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora20210311233046.png"><p>更新：2021-3-14 09:50:46 后面经过再一次测试，发现步骤7，8返回值的用途，更新时序图</p><img src="https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora20210314095226.png"><h3 id="小程序编写" tabindex="-1"><a class="header-anchor" href="#小程序编写" aria-hidden="true">#</a> 小程序编写</h3>',21),b={href:"https://github.com/wechat-miniprogram/miniprogram-demo",target:"_blank",rel:"noopener noreferrer"},m=e("br",null,null,-1),g={href:"https://www.jianshu.com/p/ef4a77328b70",target:"_blank",rel:"noopener noreferrer"},_={href:"https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typoraGDEI%E7%83%AD%E6%B0%B4.7z",target:"_blank",rel:"noopener noreferrer"},f=t('<h3 id="补充" tabindex="-1"><a class="header-anchor" href="#补充" aria-hidden="true">#</a> 补充</h3><p>这里涉及到openid参数填写<br> 我是直接通过抓包的参数拿到的那个openid<br> 随便填的话会在getOpenData那个步骤官网提示用户不存在</p><div class="custom-container danger"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M10 10l4 4m0-4l-4 4"></path></g></svg><p class="custom-container-title">风险</p><p>由于openid和saveConsLog的问题<br> 理论上学校是可以查看到日志的<br> 一直使用的话会发现某个openid一直开启但没有消费记录</p></div>',3);function k(x,w){const a=s("ExternalLinkIcon");return o(),h("div",null,[p,e("p",null,[r("BurpSuite抓包主要就是把证书装在手机上，就可以了"),l,e("a",d,[r("文章参考"),n(a)])]),u,e("p",null,[r("UI代码主要参考"),e("a",b,[r("官方demo"),n(a)]),r("里的蓝牙部分"),m,e("a",g,[r("蓝牙部分参考"),n(a)])]),e("p",null,[e("a",_,[r("源码下载"),n(a)])]),f])}const v=i(c,[["render",k],["__file","ershiyushishuikongxuexiban.html.vue"]]);export{v as default};
